  

# Client SDK Call Button - Adding Calls to your App in less then 5 minutes
### Prerequisites
- Use an existing Nexmo Application or [create a new one](https://developer.nexmo.com/client-sdk/in-app-voice/getting-started/app-to-app-call/ios).

- Have at least one user or [create it](https://developer.nexmo.com/client-sdk/in-app-voice/getting-started/app-to-app-call/ios) for your Nexmo Application, with a [valid JWT](https://developer.nexmo.com/client-sdk/in-app-voice/getting-started/app-to-app-call/ios).

- Set up a [webhook](https://developer.nexmo.com/concepts/guides/webhooks) for [Voice API](https://developer.nexmo.com/application/overview#webhooks).
##

In this *short* tutorial we will see how you can simply add calls to your application, using a custom UI component. `NXMCallButton`

When the button is clicked will add a button to our application, 
your desired callee will be called using the Nexmo Client SDK. The callee can be either an in-app user or a PSTN number (i.e, regular phone number).
To add create an app using our component, we need to follow the next steps:

1. Install Nexmo Client
2. Adding and Configuring the Call Button.



In this example, the project would be called `MyApp` and will be located in `~/Documents/MyApp`. We begin with an empty `Single View App` template generated by Xcode.

*Note for Xcode 11:*  When choosing options for your new project, make sure  you select the `Storyboard` value for the `User Interface` field if the field exists. 

![enter image description here](https://i.imgur.com/8F6llaC.png)

Let's begin!
## Step 1 - Installing Nexmo Client

#### Initiating CocoaPods for your Project
We need to initiate CocoaPods in our project, Let's execute the following commands:
```cd ~/Documents/MyApp```
```pod init```

#### Adding Required Dependencies
A file name `Podfile` would be created. We will need to modify it so we can install the  `NexmoClient` Pod.  Open `Podfile` using Xcode and modify it like so:

```
target 'MyApp' do
  use_frameworks!
  pod 'NexmoClient', '1.1.0'
end
```
Close all Xcode instances and execute the following:
 `pod update`

`MyApp.xcworkspace`  file would be created, you should now open your project only using this file.


#### Adding the NXMCallButton
Download the `NXMCallButton.swift` source file from
[https://raw.githubusercontent.com/nexmo-community/client-sdk-call-button/master/NXMCallButton.swift](https://raw.githubusercontent.com/nexmo-community/client-sdk-call-button/master/NXMCallButton.swift)
Make sure 	you download it under the name `NXMCallButton.swift` and **not** `NXMCallButton.swift.txt`.


Now that we have the source for the call button downloaded, we need to add it our project.

In Xcode, click on *File -> Add Files to "MyApp'"...* and select the `NXMCallButton.swift` file. After the file has been added, make sure it resides under your project's target, like your other project files.



#### Adding required permissions
The call button will perform a call, hence permission to use the microphone is required. When the call button will be clicked, a permission request will be presented to the user, requesting access to record audio. This permission request is already implemented by the button.

In addition, you need to state why the record permission is necessary. Open Xcode and then open `Info.plist` , right click and choose  *Add Row* option, insert `NSMicrophoneUsageDescription` as the key for the row. The row value should be a string describing the reason your app wants to access the microphone, e.g, "Audio Calls".



![Adding microphone usage permission to Info.plist](https://i.imgur.com/N2h46i2.png)
## Step 2 - Adding and Configuring the Custom UI Component

After `NXMCallButton.swift` file was added to your project, we will add the call button UI component to the Application's UI. Make sure you have opened the project using the `.xcworkspace` file.

We can do it in 2 different ways: either with the help of the storyboard or programmatically.

#### Method 1: Adding the Call Button Using the Storyboard
1. Open `Main.storyboard`.
2.  Select a `Button` object from the object library and add it to the interface.
![Adding a button object to the interface](https://i.imgur.com/a0uSJgX.png)

3. Change the custom class of the view to `NXMCallButton`
![enter image description here](https://i.imgur.com/eyw8RYb.png))
4. Configure the inspectable parameters of the component: 	
 - `Nexmo Token` should be a valid [JWT Token](https://developer.nexmo.com/conversation/guides/user-authentication) you use to authenticate your Nexmo Client instance
 - `Callee` should be a PSTN phone number, or a username of a user in your app, which will be called when the button is clicked.

Note: If you want to change the `Nexmo Token` and `Callee` parameters dynamically, you can do so programmatically as explained in the next section.

#### Method 2: Adding the Call Button Programmatically
Adding the Call Button programmatically allows changing the button parameters, such as `callee` and `nexmoToken`  dynamically.  In addition to calling the callee, further actions can be added for when the button is clicked - for example switching to a different screen.

Open `ViewController.swift` and add the following lines as required.  

```swift 
import UIKit
import NexmoClient

class ViewController: UIViewController {
	override func viewDidLoad() {
	  super.viewDidLoad()

	  let callButton = NXMCallButton()
	  callButton.callee = "15555551234" // Phone Number or username
	  
	  // * Authentication *
	  // Option 1: Authenticate using token
	  callButton.nexmoToken = "YOUR_JWT_TOKEN"
	  callButton.login()

	  // Option 2: Use an already authenticated Nexmo Client Instance
	  let myNexmoClient = NXMClient.shared
	  myNexmoClient.login(withAuthToken: "YOUR_JWT_TOKEN")
	  callButton.nexmoClient = myNexmoClient

	  
	  // * UI Setup (optional) *
	  // NXMCallButton is a subclass of UIButton so contains all of its attributes
	  callButton.frame = CGRect(x: 100, y: 100, width: 100, height: 50)
	  callButton.backgroundColor = .green
	  callButton.setTitle("Call", for: .normal)

	  // A target which performs a call when the button is pressed is already added
	  // But you can add your own, for example:
	  callButton.addTarget(self, action: #selector(buttonAction), for: .touchUpInside)

	  // Add button to UI
	  self.view.addSubview(callButton)
	}

	@objc func buttonAction(sender: UIButton!) {
	  print("Button tapped")
	}
}

```

It is also possible to add a completion handler for after a call has been started, allowing you, the developer, for example, to present a message to the user that a call has been started or display a different screen. 


```swift
let myCallCompletionHandler = { (err: Error?, call: NXMCall?) in
	if (err != nil) {
		// Handle error
	} else {
		// Handle success
		// For example: switch to a different view presenting a call session
	}
}

callButton.callCompletionHandler = myCallCompletionHandler
```
##
Copyright (c) 2019 Vonage. All rights reserved. 
