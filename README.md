  

# Client SDK Call Button - Adding Calls to your App in less then 5 minutes



In this *short* tutorial we will see how you can simply place calls from your application, using a custom UI component. `NXMCallButton`

As the name suggests, `NXMCallButton` is a button. 
When this button is clicked,  your callee of choice will be called using the Nexmo Client SDK. The callee can be either an in-app user or a regular phone number, according to how the button is configured.

To create an app using our component, we need to follow the next steps:

1. Install Nexmo Client
2. Adding and Configuring the Call Button.

### Prerequisites
- Use an existing Nexmo Application or [create a new one](https://developer.nexmo.com/client-sdk/in-app-voice/getting-started/app-to-app-call/ios).

- Have at least one user or [create it](https://developer.nexmo.com/client-sdk/in-app-voice/getting-started/app-to-app-call/ios) for your Nexmo Application, with a [valid JWT](https://developer.nexmo.com/client-sdk/in-app-voice/getting-started/app-to-app-call/ios).

- Set up a [webhook](https://developer.nexmo.com/concepts/guides/webhooks) for [Voice API](https://developer.nexmo.com/application/overview#webhooks).
##

In this example, the project would be called `MyApp` and will be located in `~/Documents/MyApp`. We begin with an empty `Single View App` template generated by Xcode.

*Note for Xcode 11:*  When choosing options for your new project, make sure  you select the `Storyboard` value for the `User Interface` field if the field exists. 

![enter image description here](https://i.imgur.com/8F6llaC.png)

Let's begin!
## Step 1 - Installing Nexmo Client

#### Initiating CocoaPods for your Project
We need to initiate CocoaPods in our project, Let's execute the following commands:
```cd ~/Documents/MyApp```
```pod init```

#### Adding Required Dependencies
A file named `Podfile` was created. We will need to modify it so we can install the  `NexmoClient` Pod.  Open `Podfile` using Xcode and modify it like so:

```
target 'MyApp' do
  use_frameworks!
  pod 'NexmoClient'
end
```
Close all Xcode instances and execute the following:
 `pod update`

Now we can go straight ahead to the fun stuff! let's add the button to our UI.

#### Adding required permissions
The call button will perform a call, hence permission to use the microphone is required. When the call button will be clicked, a permission request will be presented to the user, requesting access to record audio. This permission request is already implemented by the button.

In addition, you need to state why the record permission is necessary. Open Xcode and then open `Info.plist` , right click and choose  *Add Row* option, insert `NSMicrophoneUsageDescription` as the key for the row. The row value should be a string describing the reason your app wants to access the microphone, e.g, "Audio Calls".



![Adding microphone usage permission to Info.plist](https://i.imgur.com/N2h46i2.png)

#### Adding the NXMCallButton
Create a new empty Swift file named `NXMCallButton.swift` in your project. Copy the contents of the following URL into your  `NXMCallButton.swift` file:
[https://raw.githubusercontent.com/nexmo-community/client-sdk-call-button/master/NXMCallButton.swift](https://raw.githubusercontent.com/nexmo-community/client-sdk-call-button/master/NXMCallButton.swift)

Now that we have the implementation for the call button ready, we just need to add it to our UI. 


## Step 2 - Adding and Configuring the Custom UI Component

After `NXMCallButton.swift` file was added to your project, we will add the call button UI component to the Application's UI. Make sure you have opened the project using the `.xcworkspace` file.

We can do it in 2 different ways: either with the help of the storyboard or programmatically.

#### Method 1: Adding the Call Button Using the Storyboard
1. Open `Main.storyboard`.
2.  Select a `Button` object from the object library and add it to the interface.
![Adding a button object to the interface](https://i.imgur.com/a0uSJgX.png)

3. Change the custom class of the view to `NXMCallButton`
![enter image description here](https://i.imgur.com/eyw8RYb.png)
4. Configure the inspectable parameters of the component: 	
 - `Nexmo Token` should be a valid [JWT Token](https://developer.nexmo.com/conversation/guides/user-authentication) you use to authenticate your Nexmo Client instance
 - `Callee` should be a PSTN phone number, or a username of a user in your app, which will be called when the button is clicked.

Note: If you want to change the `Nexmo Token` and `Callee` parameters dynamically, you can do so programmatically as explained in the next section.

#### Method 2: Adding the Call Button Programmatically
Adding the Call Button programmatically allows changing the button parameters, such as `callee` and `nexmoToken`  dynamically.  In addition to calling the callee, further actions can be added for when the button is clicked - for example switching to a different screen.

To add the button programmatically to a view controller, we need to do the following steps:
1. Create a new instance of `NXMCallButton`
2. Set a value for the `callee` field of the `NXMCallButton` instance. Nexmo Client SDK will call your desired callee when the button is clicked.
3. Authenticate your Nexmo Client instance. There are 2 options to do this, either call the `login(withAuthToken:)` function of `NXMClient.shared`  directly, or set the `nexmoToken` field of the `NXMCallButton` instance and the call its login function.
4. Optional: Perform UI setup as you wish, such as configuring a background color and constraints. `NXMCallButton` inherits from `UIButton` so all `UIButton`'s properties are available to you.
5. Optional: Add additional actions to the button. For example, an action that segues to a different view when the button is clicked.
6. Add the call button to your view.

How this look like in code? let's see.
`ViewController.swift`: 

```swift 
import UIKit
import NexmoClient

class ViewController: UIViewController {
	override func viewDidLoad() {
	  super.viewDidLoad()
		
	  let callButton = NXMCallButton()
	  callButton.setTitle("Call", for: .normal)
	  callButton.callee = "15555551234" // Phone Number or username
	  
	  // * Authentication *
	  // Option 1: Authenticate using token
	  callButton.nexmoToken = "YOUR_JWT_TOKEN"
	  callButton.login()

	  // Option 2: Authenticate Nexmo Client yourself
	  NexmoClient.shared.login(withAuthToken: "YOUR_JWT_TOKEN")

	  
	  // * UI Setup (optional) *
	  //  for example:
	  callButton.backgroundColor = .lightGray
	   // Set this to false for adding the constraints down below
	  callButton.translatesAutoresizingMaskIntoConstraints = false


	  // A target which performs a call when the button is pressed is already added
	  // But you can add your own, for example:
	  callButton.addTarget(self, action: #selector(buttonAction), for: .touchUpInside)

	  // Add button to UI
	  self.view.addSubview(callButton)
	  let height = 30;
		
	  // Add your desired layoud constrains, for example:
	  NSLayoutConstraint.activate([
	            callButton.leadingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.leadingAnchor),
	            callButton.trailingAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.trailingAnchor),
	            callButton.topAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.bottomAnchor,constant: -height),
	            callButton.bottomAnchor.constraint(equalTo: self.view.safeAreaLayoutGuide.bottomAnchor),
	            ])
	}

	@objc func buttonAction(sender: UIButton!) {
	  print("Button tapped")
	}
}

```

It is also possible to add a completion handler for after a call has been started, allowing you, the developer, for example, to present a message to the user that a call has been started or display a different screen. 


```swift
let myCallCompletionHandler = { (err: Error?, call: NXMCall?) in
	if (err != nil) {
		// Handle error
	} else {
		// Handle success
		// For example: switch to a different view presenting a call session
	}
}

callButton.callCompletionHandler = myCallCompletionHandler
```

## Summary

In this tutorial we saw the process of integrating calls to our app in a simple way - using a custom `NXMCallButton` component. We saw 2 ways to do this, either programmatically or using the interface builder. Using the interface builder, we can easily integrate without a line of a code. Adding the button programmatically, we have the freedom to modify and configure it dynamically.

If you want to see the magic happening in front of your eyes - set the callee to your phone number, run the app, and click the button. 

## Further Reading
- [Nexmo SDKs and Tools](https://developer.nexmo.com/tools)
- [NXMCallButton.swift on GitHub](https://github.com/nexmo-community/client-sdk-call-button)
##
Copyright (c) 2019 Vonage. All rights reserved. 
